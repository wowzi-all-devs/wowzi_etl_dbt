with
fp as
(
  select 
  id,amount,status,task_id,approver,currency,fullname,provider,bank_code,bank_name,narration,reference,created_at,
  tax_amount,updated_at,is_approved,retry_count,transfer_id,bank_country,date_created,gross_amount,creation_time,
  exchange_rate,influencer_id,account_number,payment_method,processed_date,complete_message,requires_approval,
  payment_eligible_at,
    CASE 
    WHEN DATE(payment_eligible_at) BETWEEN CURRENT_DATE() AND DATE_ADD(CURRENT_DATE(), INTERVAL 5 DAY) 
      THEN 'Next 5 Days' 
    
    WHEN DATE(payment_eligible_at) BETWEEN CURRENT_DATE() AND DATE_ADD(CURRENT_DATE(), INTERVAL 7 DAY) 
      THEN 'Next 7 Days' 
      ELSE 'Beyond 7 Days' 
    END AS payable_days_flag,
    
  from bi-staging-1-309112.wowzi_airbyte.influencer_transfers
  where payment_eligible_at >= '2025-01-02' --payments from jan 2nd payment_eligible_at
  and lower(status) in ('completed', 'successful', 'manual') 
  and influencer_id <> 126859
  and task_id <> 390450
  order by date_created asc
 ),
inf as 
(
 select 
 inf.influencer_id,
 inf.company_id,
 initcap(inf.company_name) company_name,
 inf.campaign_id,
 initcap(cf.campaign_name) campaign_name,
 inf.job_id,
 inf.task_id,
 inf.job_status,
--  initcap(loc.income_category) income_category,
 inf.country,
 inf.job_offer_date,
 inf.task_creation_date,
 inf.no_of_tasks,
 inf.completed_tasks,
 initcap(inf.invitation_status) invitation_status,
 case when loc.location is null then 'Not Provided' else
 initcap(loc.location) end as location,
 inf.amount_lcy job_value,
 case when inf.company_id IN (1191, 5957, 6121, 17398, 19907, 19773, 20248)
--   ('Safaricom', 'Mediacom', 'Uk-Kenya Tech Hub', 
--  'Equity Bank', 'Predator', 'Infinix', 'Kenya Tourism Board') 
 then 0 else 1 end as order_flg 
 FROM bi-staging-1-309112.wowzi_dbt_prod.influencer_job_breakdown inf
 LEFT JOIN bi-staging-1-309112.wowzi_dbt_prod.influencer_facts loc on inf.influencer_id = loc.influencer_id 
 LEFT JOIN bi-staging-1-309112.wowzi_dbt_prod.campaign_facts cf on inf.campaign_id = cf.campaign_id 
--  FROM {{ ref('influencer_job_breakdown') }} inf
--  LEFT JOIN {{ ref('influencer_facts') }} loc on inf.influencer_id = loc.influencer_id 
),
semi_final as
(
select 
 fp.id payment_id,
 fp.influencer_id,
 inf.company_name,
 inf.company_id,
 inf.campaign_id,
 inf.campaign_name,
 inf.job_id,
 fp.task_id,
 inf.job_status,
 inf.no_of_tasks,
 inf.completed_tasks,
--  inf.income_category,
 inf.country,
 inf.location,
 CASE WHEN 
 fp.transfer_id = 0 then null else fp.transfer_id 
 end as transfer_id,
 fp.currency,
 inf.job_value,
 (fp.amount * 0.09) / 12 fast_pay_fee,
 fp.amount paid_amount,
 case when lower(fp.status) = 'successful' then 'Successful - Backoffice' else 'Successful - Marked' end as payment_status,
fp.provider,
 case when
 fp.provider <> 'MPESA_KE' THEN 'Cellulant'
 when 
 fp.provider is null THEN fp.provider
 ELSE 'MPESA' END as payment_channel,
 fp.reference,
 date(fp.creation_time) creation_time,
 fp.processed_date payment_date,
 case when date(fp.processed_date) > current_date() then 'Future_payment' else 'Past_payment' end as payment_flag,
 extract(month from date(fp.processed_date)) mon,
 extract(year from date(fp.processed_date)) yr,
 concat(FORMAT_DATETIME("%b", DATETIME(date(fp.payment_eligible_at))),"-", extract(year from date(fp.payment_eligible_at))) mon_yr,
 dense_rank () over (order by extract(year from date(fp.payment_eligible_at)) asc, extract(month from date(fp.payment_eligible_at))asc) mon_yr_rnk,

 EXTRACT(QUARTER FROM DATE(fp.payment_eligible_at)) AS quarter,

 CONCAT("Q", CAST(EXTRACT(QUARTER FROM DATE(fp.payment_eligible_at)) AS STRING), "-", CAST(EXTRACT(YEAR FROM DATE(fp.payment_eligible_at)) AS STRING)) AS 
   qtr_yr,

 DENSE_RANK() OVER (ORDER BY EXTRACT(YEAR FROM DATE(fp.payment_eligible_at)) ASC,
 EXTRACT(QUARTER FROM DATE(fp.payment_eligible_at)) ASC) 
AS qtr_yr_rnk,

fp.payable_days_flag,
 case 
  when 
  date(fp.payment_eligible_at) < current_date() 
  and lower(fp.status) = 'waiting_for_payment' 
  then 'old_unpaid' else 'Paid_or_upcoming'
  end as 
clean_payment_flag,
order_flg
 FROM fp 
 LEFT JOIN inf on fp.task_id = inf.task_id
 order by order_flg
),
final as 
(
  select 
  *,
  /*used window function to get the total paid to an influencer in a quarter*/
  SUM(paid_amount) OVER (PARTITION BY influencer_id) AS period_total_paid, --- qtr_yr add for quarter specific

  /*used paymnt_rnk to rank the total payments made in a quarter
   so i could select only the first so as not to double count the total paid in a quarter.
  */
  row_number() over (Partition by influencer_id order by payment_date) as paymnt_rnk,  --- qtr_yr add for quarter specific

    CASE 
    WHEN SUM(paid_amount) OVER (PARTITION BY influencer_id, qtr_yr) < 20000 THEN '< 20K'
    WHEN SUM(paid_amount) OVER (PARTITION BY influencer_id, qtr_yr) BETWEEN 20000 AND 49999 THEN '20K - 50K'
    WHEN SUM(paid_amount) OVER (PARTITION BY influencer_id, qtr_yr) BETWEEN 50000 AND 99999 THEN '50K - 100K'
    WHEN SUM(paid_amount) OVER (PARTITION BY influencer_id, qtr_yr) BETWEEN 100000 AND 249999 THEN '100K - 250K'
    ELSE '> 250K'
  END AS paid_bucket,

   CASE 
    WHEN SUM(paid_amount) OVER (PARTITION BY influencer_id) < 49500 THEN 'Below DFW' --, qtr_yr
    ELSE 'Above DFW'

  END AS DFW_Category
  from semi_final
)
select 
      a.payment_id, b.influencer_id, a.company_name, 
      case when a.company_id in 
      (17206,16194,17215,19197,17234,19870,17212,19860,17263,17224,
      17225,17214,17217,2382,17229,17223,17226,17228,20103) then 
      'Regulated Beverage Sector' else 'General Market Sector' 
      end as brand_category,
       a.campaign_id, a.campaign_name, a.job_id,
       a.task_id, a.job_status, a.no_of_tasks, a.completed_tasks, Initcap(b.gender) gender,
       b.age_range age_groups, b.country, b.location, a.transfer_id,
       a.currency, a.job_value,
       payment_status, provider, payment_channel, reference,
       payment_date,
       creation_time, payment_flag, mon, yr, quarter, mon_yr, qtr_yr,  mon_yr_rnk,
       qtr_yr_rnk,
       payable_days_flag, clean_payment_flag, order_flg,
       case when paymnt_rnk = 1 then period_total_paid else null end as period_total_paid, 
       paymnt_rnk,
       fast_pay_fee, paid_amount,
       paid_bucket, DFW_Category,
      case when a.payment_id in
      (294783,292157,293281,293279,290721,292147,292146,293280,291325,289688,289687,290709,289780,289778,292877,290171,290170,
      290168,287741,286442,285791,289581,292912,290746,289779,292776,286030,290169,285993,289191,290340,288238,288528,
      289192,288265,293262,292722,292982,293218,292784,292760,292955,292720,293627,293541,293519,293413,293274,293241,
      293222,292748,292701,292689,292939,293097,293045,293012,293003,293000,293651,293628,292778,293082,293069,293067,
      293065,293062,293058,293053,293040,292997,292989,292987,292984,292956,292954,292942,292940,293132,293117,293116,
      293109,293101,293098,293096,293095,293094,293093,293091,293088,293086,293081,293074,293071,293063,293060,293052,
      293042,293035,293031,293028,293027,293025,293022,293021,293020,293019,293016,293014,293013,293009,293008,293006,
      293005,293004,293002,293001,293636,293566,293428,293422,293415,293412,293367,293363,293653,293358,293356,293632,
      293626,293617,293348,293610,293345,293340,293325,293319,293304,293248,293204,293203,293202,293200,293194,293185,
      293176,293543,293542,293538,293536,293518,294498,294497,294496,294495,294494,294493,294491,294490,294485,293433,
      294484,293414,293374,294483,294482,294481,293310,294480,294479,293289,293287,294478,293277,293269,293266,293264,
      293263,293259,293256,293254,293253,293252,293249,294477,293246,293245,293244,293243,293242,293240,293239,293235,
      293232,293229,293227,293226,293225,293223,293221,293220,293219,294475,294474,294473,294472,294471,294470,294469,
      294468,294467,294466,294465,293197,293196,294464,294463,294462,294461,294460,294459,294458,294457,294456,294455,
      294454,294453,294452,294450,294449,294433,294429,294423,294420,294394,294387,294386,294385,294383,294382,294381,
      294380,294379,294378,294330,294329,294312,294309,294308,294307,294141,294139,294138,294132,294131,294130,294129,
      294128,294127,294126,294125,294103,294101,294096,294095,294094,294093,294092,294091,294090,294088,294087,294086,
      294085,294078,294068,294066,294065,294064,294063,294062,294061,294058,294057,294056,294054,294053,294034,294033,
      294032,294031,294030,294029,294028,294027,293975,293974,293973,293972,293971,293970,293969,293968,293967,293966,
      293965,293964,293963,293962,293961,293960,293959,293958,293957,293956,293955,293954,293953,293951,293949,293948,
      293947,293946,293945,293944,293943,293942,293940,293938,293937,293936,293935,293934,293933,293931,293930,293928,
      293926,293921,293920,293917,293916,293915,293914,293913,293912,293910,293909,293908,293907,293906,293905,293904,
      293903,293902,293900,293899,293897,293896,293895,293894,293893,293892,293891,293890,293889,293888,293877,293876,
      293875,293874,293873,293872,293871,293870,293869,293867,293865,293864,293862,293861,293860,293859,293857,293856,
      293855,293854,293853,293851,293849,293848,293846,293843,293842,293841,293840,293839,293838,293837,293836,293834,
      293833,293832,293831,293830,293829,293828,293827,293826,293824,293823,293822,293821,293820,293819,293817,293816,
      293815,293814,293812,293810,293809,293806,293804,293803,293802,293799,293798,293797,293792,293791,293788,293787,
      293786,293785,293784,293783,293782,293781,293780,293777,293776,293774,293773,293772,293770,293769,293768,293767,
      293766,293765,293763,293761,293760,293756,293755,293748,293747,293746,293744,293743,293740,293738,293737,293736,
      293734,293733,293732,293731,293730,293728,293726,293725,293724,293723,293722,293720,293717,293712,293709,293708,
      293706,293704,293703,293702,293701,293700,293699,293698,293697,293696,293695,293694,293691,293690,293688,293687,
      293686,293685,293684,293683,293682,293680,293679,293676,293675,293667,293644,293606,293605,293604,293603,293602,
      293601,293600,293598,293597,293595,293594,293593,293592,293591,293590,293583,293580,293578,293575,293574,293572,
      293570,293569,293567,293565,293564,293563,293562,293561,293560,293559,293558,293557,293556,293555,293554,293553,
      293517,293516,293515,293514,293513,293511,293509,293508,293506,293505,293504,293500,293499,293498,293495,293493,
      293492,293490,293489,293487,293485,293484,293483,293481,293480,293479,293478,293477,293476,293475,293474,293473,
      293472,293471,293470,293469,293468,293466,293465,293464,293463,293462,293461,293460,293458,293456,293455,293454,
      293451,293450,293449,293448,293447,293445,293444,293443,293442,293441,293440,293438,293437,293435,293429,294542,
      294606,294567,294596,294499,294597,294586,294503,294600,294541,294589,294576,294500,294509,294585,294590,294528,
      294557,294605,294603,294598,294604,294560,294601,294550,294564,292811,292805,292800,292765,292822,292814,292789,
      292787,292785,292781,292767,292751,292740,292728,292725,292717,292706,293089,293032,293026,293015,293749,293370,
      293272,293231,293228,293066,292988,293104,293034,293030,293024,293023,293671,293540,293491,293432,293276,293238,
      293236,287124,286997,292821,292793,292788,292786,292769,292763,292690,293057,293056,292991,292990,292936,293119,
      293118,293110,293108,293102,293100,293099,293092,293087,293078,293077,293075,293061,293041,293039,293038,293036,
      293018,293017,293011,293010,293007,293721,293689,293585,293571,293452,293401,293360,293359,293351,293350,293342,
      293328,293320,293318,293305,293613,293612,293539,293535,293375,293290,293288,293285,293284,293267,293265,293261,
      293260,293258,293257,293255,293251,293250,293234,293230,293224,293195,292803,292796,292779,292756,292745,292718,
      292702,292688,292820,292819,292815,292807,292806,292797,292794,292774,292768,292766,292757,292738,292735,292729,
      292726,292724,292723,292711,292687,288302,288277,288300,288348,288088,288087,288086,288085,288090,288089,288092,
      288091,288084,288080,288324,288268,288076,288083,288432,288269,289527,289507,288242,289755,288243,289338,288241,
      289462,289549,289356,289495,289351,289343,289342,289341,289337,289335,289448,289357,290028,290109,289844,290099,
      290081,289596,289355,290100,289336,290117,290078,289671,289670,289344,289676,289675,289674,289673,289672,289365,
      289430,289437,289420,289384,289379,289377,289376,289436,289411,289444,289428,289412,289395,289367,289440,289434,
      289432,289418,289408,289406,289404,289396,289393,289390,289389,289388,289382,289381,289447,289446,289445,289443,
      289442,289441,289439,289438,289435,289433,289431,289429,289427,289425,289424,289423,289422,289421,289419,289417,
      289416,289415,289414,289413,289410,289409,289407,289405,289403,289402,289401,289399,289398,289397,289394,289392,
      289391,289387,289386,289385,289383,289380,289378,289374,289373,289372,289370,289369,289368,289364,289363,289362,
      289530,289517,289491,289487,289475,289464,289459,289482,289541,289523,289520,289516,289513,289500,289497,289490,
      289466,289546,289545,289543,289540,289534,289655,289526,289525,289521,289505,289499,289498,289483,289474,289450,
      289547,289542,289539,289538,289537,289536,289532,289531,289529,289528,289522,289519,289518,289515,289512,289511,
      289506,289504,289503,289859,289502,289501,289496,289493,289492,289489,289488,289485,289484,289481,289480,289479,
      289478,289477,289476,289473,289471,289470,289469,289468,289467,289465,289461,289460,289458,289457,289456,289455,
      289454,289453,289452,289451,289566,289565,289559,289558,289557,289556,290138,290137,290136,290135,290133,290130,
      290129,290128,290126,290125,290124,290123,290121,290120,290119,290114,290111,290108,290107,290106,290105,290103,
      290102,290101,290098,290097,290096,290095,290094,290092,290091,290090,290089,290088,290087,290086,290084,290083,
      290080,290079,290077,290076,290075,290074,290072,290071,290070,290068,290067,290066,290065,290064,290063,290062,
      290061,290060,290059,290058,290057,290056,290055,290054,290053,290052,290047,290045,290043,290042,290041,290040,
      290039,290038,290037,290036,290033,290032,290023,290020,290014,290013,290012,290011,290010,290009,290008,290007,
      290006,290005,290004,290003,290002,290001,290000,289999,289998,289997,289996,289995,289994,289993,289992,289991,
      289989,289988,289987,289984,289981,289975,289973,289972,289971,289970,289969,289967,289965,289964,289963,289961,
      289960,289959,289952,289951,289950,289949,289948,289947,289946,289944,289943,289942,289941,289940,289939,289938,
      289937,289936,289935,289934,289933,289801,289792,289766,289765,289763,289762,289751,289749,289748,289747,289746,
      289745,289744,289740,289731,289730,289729,289728,289727,289725,289724,289723,289722,289720,289708,289706,289699,
      289698,289697,289696,289695,289693,289692,289685,289682,289681,289680,289679,289375,289654,289652,289651,289650,
      289649,289648,289647,289645,289644,289643,289642,289641,289640,289639,289638,289637,289636,289635,289634,289633,
      289632,289630,289629,289628,289627,289626,289625,289624,289620,289619,289616,289615,289610,289591,289586,289563,
      289555,289573,289572,289571,289568,289564,289562,289561,289560,289717,289716,289715,289714,289713,289712,289711,
      289710,289709,289707,289705,289704,289703,289702,289701,289700,289694,289691,289677,289666,289664,289663,289660,
      289659,289657,289656,289646,289631,289621,289618,289617,289614,289612,289609,289605,289601,289600,289597,289595,
      289594,289593,289592,289590,289589,289585,289584,289582,289580,289579,289577,289576,289575,289569,289574,289570,
      289721,289690,289684,289678,289668,289613,289603,289623,289587,289578,289567,289608,289599,289719,289718,289669,
      289667,289665,289662,289661,289658,289653,289622,289607,289606,289604,289602,289598,289588,289583,289783,289754,
      289955,289954,289810,289808,289806,289764,289750,289816,289812,289793,289786,289782,289789,289771,289753,289752,
      289738,289736,289735,289726,289953,289822,289807,289805,289804,289791,289787,289785,289759,289758,289823,289817,
      289814,289768,289821,289809,289802,289799,289788,289781,289757,289756,289737,289732,289820,289813,289798,289769,
      289767,289761,289742,289734,289819,289818,289815,289803,289796,289790,289784,289774,289773,289772,289760,288263,
      289743,289741,289739,289733,289897,289863,289900,289896,289892,289889,289879,289866,289862,289851,289835,289832,
      288262,289894,289886,289845,289826,289873,289870,289846,289836,289831,289825,289882,289877,289876,289865,289834,
      289833,289828,289827,289824,289837,289893,289839,289985,289976,289899,289869,289840,289913,289895,289871,289864,
      289990,289986,289977,289932,289927,289925,289902,289901,289898,289868,289856,289850,290046,290069,290051,290050,
      290049,290035,290031,290029,288077,290027,290025,290021,290019,290018,290015,290048,290044,290030,290026,290024,
      290022,290017,290016,290143,290142,290141,290140,290139,290134,290132,290131,290122,290118,290116,290115,290113,
      290112,290110,290104,290085,290073,286401,285771,286106,285615,286590,286129,282216,286118,286145,285915,285871,
      283199,285571,285842,285883,286115,285533,285837,285741,285616,286464,286533,286045,286197,286013,286262,285667,
      285658,286230,285921,286088,286169,286040,286649,285940,285863,286156,286121,286608,286256,286645,286384,285806,
      285875,286044,282172,278651,286458,285623,285830,286566,286460,286538,286410,285559,286587,285625,286498,286292,
      286409,285821,285604,286403,286213,285542,286488,286160,285558,286558,286035,285634,285894,285675,286140,286065,
      286614,286447,286430,285826,286619,282282,286206,285784,286600,285953,285659,286615,286639,286135,286563,286309,
      286337,285850,286400,286170,286136,286071,286412,286652,286342,285586,286041,286351,285803,282178,286534,286513,
      285624,286350,286211,286108,285585,283308,286075,285887,285761,285618,282821,286380,286222,286266,286036,285527,
      286408,286158,285694,285550,286418,285959,285899,285846,286663,285956,285752,285879,286406,285992,286601,285565,
      286003,285900,286620,286066,286524,286320,286301,286655,286535,281520,285866,285600,286443,285827,286254,282126,
      280795,285540,285720,285786,285766,285732,285620,286539,285882,280077,282582,285825,286661,285782,285929,286208,
      285683,286439,285706,286126,286311,286607,286577,286422,286134,285885,286413,285581,286081,285781,286444,286290,
      286575,286166,285608,282007,285962,285589,285722,286111,286078,286588,286363,286191,285723,285745,285699,285773,
      285642,285649,285839,286584,286265,281561,286425,285812,278037,286279,286227,286128,285811,285800,286613,286177,
      285762,286355,286510,285537,286537,282173,285780,286340,286328,285695,285744,285687,286386,285868,286499,286583,
      285949,281460,286116,285902,285637,285905,286218,286093,286373,286251,286451,285579,285925,286033,285755,286161,
      286647,286434,286432,285534,285952,286064,285696,285911,285690,285872,286382,286381,286516,286509,285725,285712,
      286219,286220,286438,286469,286468,285653,286010,285652,285521,285750,286124,285914,279999,285748,286440,286387,
      281312,286172,286362,286224,285874,286021,283040,286541,286553,286142,285678,286038,286526,286178,286635,286630,
      285639,285556,286329,285843,286637,285591,286199,285777,286621,285601,286313,286032,285674,286253,285673,286084,
      286561,286551,286548,286462,286302,286120,285920,286602,285836,286593,285679,286204,285856,285539,286257,286179,
      285991,285671,286138,286188,282179,285626,285923,285922,286347,285805,286159,285617,286173,286502,285544,286061,
      286456,286182,286585,285950,286024,286503,286131,286624,286299,286185,285563,286450,285576,285844,285636,286421,
      286325,286186,286043,281543,285783,285736,286346,286319,285756,285664,286157,286321,286371,280078,285662,285718,
      281665,286270,286023,282155,282065,286102,286660,286210,285857,285858,286519,286580,285599,286592,285545,286287,
      286379,285943,285994,285562,285564,286175,285906,285611,286137,286662,285656,286402,285663,286077,283039,285726,
      286237,286552,286339,286581,286073,285931,286398,285937,285621,286598,286103,286344,286281,286097,285737,286429,
      285916,286223,285665,285614,286579,285996,286202,286310,286092,286471,285957,285660,286550,285561,286569,286394,
      282583,285747,285543,286259,286296,285551,286646,286404,286633,286133,286147,285622,285566,285832,286397,286089,
      285685,286375,281562,285717,286360,286248,286244,286437,282008,285627,286267,285635,285845,286457,286294,285638,
      285799,286578,286423,286080,286659,285548,286622,285590,286150,285577,285602,286599,286612,286453,286255,286504,
      286250,286445,285862,286074,285672,285711,285691,286574,285917,285648,285727,285828,286063,286446,286079,286638,
      281461,286529,285881,286417,285910,282290,282169,285907,285749,286576,285632,286193,286176,285549,286316,285743,
      286260,286229,286153,286212,286567,281523,281119,285607,286582,286441,285583,286343,285630,286149,286240,286095,
      285729,286143,286019,286016,286467,285651,285852,286478,286029,286015,285859,285785,285568,285895,283093,285942,
      286597,286209,285546,286436,285530,285641,286261,285535,281966,281664,286507,286022,285541,281102,286377,285853,
      286512,285901,286547,285705,286521,286545,285961,286595,285684,286459,285829,286626,285802,286431,286388,286651,
      286465,285924,285948,285597,285707,285754,286532,285713,285700,286180,286653,286322,285519,286168,285865,286627,
      286284,286654,286233,286586,285876,285810,285898,285954,286174,281038,286605,285946,285633,282163,282283,282280,
      286495,286324,286144,286020,286454,286323,286125,285873,286068,286300,286119,286012,282175,283104,285944,285841,
      286470,281964,281669,281101,286194,286163,285908,285733,286603,286354,285610,286364,286370,286396,285757,281036,
      285654,286419,286146,285751,286650,285528,286162,286183,286594,286591,285941,285788,286333,286326,286604,286274,
      285584,286062,286117,286308,286448,286493,286543,286132,286520,286245,286636,286489,285629,285960,285703,285692,
      285670,285999,282281,286383,282822,286389,285644,286589,286216,286100,286433,286564,286368,285758,286241,285878,
      286640,286235,286226,285797,285668,286487,286056,286002,286001,285995,285889,285886,285831,285525,286234,286336,
      286243,286644,285767,285760,286482,285588,286341,286105,285646,285835,286506,286334,285864,286568,286562,286497,
      286365,286357,286349,286348,286278,286263,286247,286207,286190,286181,285538,285531,286455,286228,286508,286609,
      286555,286540,286085,285739,285580,285682,286352,286330,285796,285861,285657,285598,286076,286629,286067,286415,
      285768,286127,286060,282180,280082,279475,277801,286476,286435,286026,286018,285522,285897,285823,286390,286472,
      286461,286039,285877,286565,286616,285557,286307,286025,285609,286028,286027,285612,286369,286101,286335,286096,
      286628,285552,281488,285955,285918,286361,286046,286130,282632,282630,282628,286242,286648,286617,286268,285807,
      285855,286297,286525,286148,285526,285808,285801,286527,286086,286252,286393,285913,285547,286572,285775,286110,
      282167,281657,281593,285888,285676,285927,286285,285738,286031,285809,286070,286492,286353,286272,286200,285575,
      285933,282154,281979,281590,286258,285529,282090,285560,286152,286155,285643,285587,286171,286481,286239,285555,
      286656,286109,285698,286642,286634,285893,285798,286376,286366,286238,286112,285714,285938,286356,286098,286271,
      285740,285834,286358,286141,285688,286114,285661,285724,285708,285779,286338,285520,286087,286042,285574,285928,
      283211,281542,279992,276791,286123,286094,286514,286232,286288,286392,285619,286424,285578,286104,285753,286570,
      286484,286483,286479,285697,286556,285593,286047,286107,285689,282177,281484,281141,286264,285681,286643,286289,
      286072,285655,286236,285569,286345,286215,286280,285603,285818,286164,286069,285926,282291,286618,286610,285919,
      286269,285731,286411,285824,285728,286277,286657,285880,286475,286474,286571,286560,286332,286306,286305,286641,
      285804,286501,286496,286303,285769,286631,286099,285851,286203,281375,286231,286217,286283,285854,286165,285833,
      285869,286391,286385,286318,286291,286286,286276,286225,286196,285730,285721,285719,285710,286184,286511,286122,
      286494,286491,285693,285573,285838,286452,286189,285631,285628,286091,285904,286187,286606,286632,285789,285787,
      286139,286317,285677,285892,286154,286113,285596,285958,286515,286490,286083,285680,285934,286198,286275,285932,
      286530,285891,285870,286315,285734,285701,286523,286466,286463,286214,286536,285909,285592,286034,286611,285912,
      285896,286573,285935,286623,285820,286327,286314,285595,286374,285930,286090,286273,285840,285606,286658,286059,
      285939,285774,286295,286293,285570,286205,285819,286554,286549,286017,286011,286082,285640,285536,286331,286596,
      285709,285686,286304,286559,286505,286249,285903,285524,286221,285715,285567,286500,286477,286312,286201,286195,
      286531,286528,286522,286407,286405,286395,285860,285666,286416,286414,286480,285945,285554,285669,285605,285822,
      286367,286359,286058,285594,286246,286518,286517,286449,286399,286378,286282,286192,285997,285650,285572,286151,
      285532,285735,285702,285613,285951,285867,285582,286048,285936,286037,286557,286546,286544,285776,285778,285759,
      285553,286372,285746,285884,286625,286473,286167,285742,285716,285772,285770,285890) 
      then 'wowzi_pay' else 'HEVA_pay'
      end as payment_source
from final a
left join bi-staging-1-309112.wowzi_dbt_prod.influencer_facts b on a.influencer_id = b.influencer_id
