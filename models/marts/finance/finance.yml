version: 2

models:
  - name: int_bank_details
    description: "Unique Influener Bank Details"
    columns:
      - name: influencer_id
        tests:
          - not_null
          - unique
      - name: bank_name
        tests:
          - not_null
      - name: bank_account_number
        tests:
          - not_null
  - name: influencer_payouts
    description: "Payouts made to Creators/Influencers"
    columns:
      - name: transfer_id
        description: "The primary key for this table"
        tests:
          - unique
          - not_null
      - name: influencer_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__influencer_transfers')
              field: influencer_id
      - name: mobile_number
      - name: advertiser_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__merchants')
              field: advertiser_id
      - name: campaign_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__campaigns')
              field: campaign_id
      - name: task_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__influencer_tasks')
              field: task_id
      - name: campaign_name
      - name: payment_date
      - name: country
      - name: amount
      - name: currency
        tests:
          - accepted_values:
              values: ['KES', 'KE', 'TZS', 'UGX',  'USD', 'GHS', 'NGN', 'ZAR', 'MZN', 'AOA', 'ZMW', 'XAF', 'XOF', 'RWF', 'CDF', 'MGA', 'MUR', 'ETB', 'MWK', 'EGP', 'MAD', 'DZD', 'TND', 'BWP', 'NAD', 'ZWL']
      - name: payment_status
        tests:
          - accepted_values:
              values: ['Manual', 'NEW', 'SUCCESSFUL', 'successful', 'FAILED', 'Sent out', 'COMPLETED','WAITING_FOR_PAYMENT']
      - name: bank_name
      - name: company_name

  - name: influencer_weekly_successful_payouts_by_currency
    description: "Influencer successful payments by week by currency"
    columns:
      - name: payment_date_week
      - name: currency
        tests:
          - accepted_values:
              values: ['KES', 'KE', 'TZS', 'UGX',  'USD', 'GHS', 'NGN', 'ZAR', 'MZN', 'AOA', 'ZMW', 'XAF', 'XOF', 'RWF', 'CDF', 'MGA', 'MUR', 'ETB', 'MWK', 'EGP', 'MAD', 'DZD', 'TND', 'BWP', 'NAD', 'ZWL']
      - name: total_amount

  - name: influencer_expected_payouts
    description: "A list of payouts expected to be made to creators based on first verification post approval in a 2 week time window"
    columns:
      - name: influencer_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__influencer_tasks')
              field: influencer_id
      - name: first_verification_status
      - name: second_verification_status
      - name: mobile_number
      - name: campaign_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__campaigns')
              field: campaign_id
      - name: task_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__influencer_tasks')
              field: task_id
      - name: first_verification_datetime
      - name: payment_date
      - name: payment_amount_list
      - name: country
      - name: bank_name
      - name: bank_account_number
      - name: currency
      - name: weekday_name_abbreviated
      - name: payment_dates
      - name: payment_method
        tests:
          - accepted_values:
              values: ['Mobile Money', 'Bank']
      - name: payment_status
        tests:
          - accepted_values:
              values: ['Manual', 'NEW', 'SUCCESSFUL', 'successful', 'FAILED', 'Sent out', 'COMPLETED','WAITING_FOR_PAYMENT']
            
  - name: influencers_withholding_by_month_by_status
    description: "Influencers list from Kenya with a total payment greater than 24000 KES by month"
    columns:
      - name: primary_key
        description: "The primary key for this table"
        tests:
          - unique
          - not_null
      - name: influencer_id
        tests:
          - not_null
          - relationships:
              to: ref('postgres_stg__influencers')
              field: influencer_id
      - name: month
      - name: payment_status
        tests:
          - accepted_values:
              values: ['Manual', 'NEW', 'SUCCESSFUL', 'successful', 'FAILED', 'Sent out', 'COMPLETED','WAITING_FOR_PAYMENT']
      - name: total_amount
      - name: name
      - name: email
      - name: mobile_number